<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Stripe AfroStyle</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; }
        .container { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #333; text-align: center; }
        button { background-color: #635BFF; color: white; padding: 12px 30px; border: none; border-radius: 5px; font-size: 16px; cursor: pointer; width: 100%; margin-top: 20px; }
        button:hover { background-color: #5a52e8; }
        .service-card { border: 1px solid #ddd; padding: 20px; margin: 20px 0; border-radius: 8px; }
        .logs { background: #f5f5f5; padding: 15px; border-radius: 5px; margin-top: 20px; font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test Stripe AfroStyle</h1>
        
        <div class="service-card">
            <h3>Coupe Afro Premium</h3>
            <p><strong>Prix:</strong> 35,00 ‚Ç¨</p>
            <p><strong>Dur√©e:</strong> 60 minutes</p>
        </div>
        
        <button id="loginBtn" onclick="login()">
            üîê Se connecter comme admin2
        </button>
        
        <button id="payBtn" onclick="createStripeSession()" style="display:none;">
            üí≥ Payer avec Stripe (35‚Ç¨)
        </button>
        
        <div id="logs" class="logs">
            <div>üìã Logs de test :</div>
        </div>
    </div>

    <script>
        function log(message) {
            const logs = document.getElementById('logs');
            const time = new Date().toLocaleTimeString();
            logs.innerHTML += `<div>[${time}] ${message}</div>`;
            logs.scrollTop = logs.scrollHeight;
        }

        async function login() {
            log('üîê Connexion admin en cours...');
            
            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        usernameOrEmail: 'admin2',
                        password: 'Admin123!'
                    }),
                    credentials: 'include'
                });
                
                const data = await response.json();
                log(`üì¶ R√©ponse login: ${JSON.stringify(data, null, 2)}`);
                
                if (response.ok) {
                    log('‚úÖ Connexion r√©ussie!');
                    document.getElementById('loginBtn').style.display = 'none';
                    document.getElementById('payBtn').style.display = 'block';
                } else {
                    log(`‚ùå Erreur login: ${data.error || data.message || 'Erreur inconnue'}`);
                }
                
            } catch (error) {
                log(`‚ùå Erreur r√©seau login: ${error.message}`);
            }
        }

        async function createStripeSession() {
            log('üöÄ Cr√©ation de la session Stripe...');
            
            try {
                const response = await fetch('/api/payments/checkout/create-session', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include', // Important pour envoyer les cookies de session
                    body: JSON.stringify({
                        bookingId: 54,
                        amount: 25.00,
                        currency: 'EUR',
                        paymentMethod: 'CARD',
                        description: 'Test paiement r√©servation #54'
                    })
                });
                
                const data = await response.json();
                log(`üì¶ R√©ponse re√ßue: ${JSON.stringify(data, null, 2)}`);
                
                if (response.ok && data.url) {
                    log('‚úÖ Session cr√©√©e avec succ√®s!');
                    log(`üîó URL de redirection: ${data.url}`);
                    log('üöÄ Redirection vers Stripe...');
                    
                    // Rediriger vers Stripe
                    window.location.href = data.url;
                } else {
                    log(`‚ùå Erreur: ${data.error || 'Erreur inconnue'}`);
                }
                
            } catch (error) {
                log(`‚ùå Erreur r√©seau: ${error.message}`);
            }
        }
        
        log('‚úÖ Page de test charg√©e');
        log('üìç Backend: http://localhost:7777');
    </script>
</body>
</html>